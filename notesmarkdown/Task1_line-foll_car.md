# 循迹小车技术文档（初稿）

## 前言
### 关于培训

很难找到一个靠谱的电赛培训，一个原因是相当多的培训是零基础的，然后就会教一个半吊子
也有学长建议自学的，找开源代码，开源项目，动手做真题

### 关于这次小车
这次的任务是
搭建一个平台，以后很多模块都可以加在小车这个载体上；
进行一次完整的小组协作；
了解一个项目的全流程；
积累电赛时可用的模块；
事实上搭一个小车很容易，现成的底板，现成的驱动，现成的最小系统板，简单的面包板连连看，甚至有现成的代码，但是这并不完全是我们想要的

## 小车的构想（初稿）
### 小车的功能
- 普通四驱小车的运动
- 视觉循迹
- 超声
- 拓展部分：麦轮运动，蓝牙通讯，二维云台，弹射物投掷，七路灰度传感，二维激光雷达，人机交互

### 小车的结构
- 机械结构部分，计划采用两层底板中间加铜柱/电机/电池的整体结构，不做前轮转向的机械结构。
底盘需有足够多的拓展结构安装空间，包括：。。。，必须有足够稳定的、可调整角度的摄像头支架
- 电机部分，采用带GMR编码器的直流有刷电机*4
- 电机驱动部分，自制可使能的GMR编码电机驱动板，同时可使用L298N模块替换
- 主控部分，自制STM32F4主控板，引出串口、电机使能、拓展接口，同时可以使用MSPM0替换
- 视觉部分，使用K210与单片机进行通讯，支持使用主板上的人机交互模块进行二值化调试

### 测试场地
往年题的循迹场地好像是有卖的，用双车跟随的那个场地

## 困难的地方
- 仍然在踌躇是否要自制一个有刷驱动，L298N可以满足需求吗
- 写固件是一个麻烦，需要帮助
- 第一次和机械协作，经验不足

## 风险评估
- 有一定的概率1个月做不出来，有一定的概率固件写不出来且自制模块难以找到源码
- 是否需要准备第二个赛道，比如精密仪器测量
- 真正的电赛时间紧迫，四天时间不太可能打板，只能用已有的模块+洞洞板/面包板
  
## 任务导向
需确定机械结构大小并同步-->在约定好的情况下画：有刷电机驱动（5day）、降压模块（0.5day）、主控板（3day）-->生产和快递（5day）-->焊接组装（1day）-->固件（7day）-->调试（7day）（不吃不喝）



# 循迹小车技术文档
## 一、文档概要
这是经过网络调研后，结合自身情况，可拓展性，材料可获取度，生成的第二版技术文档初稿；
须要成员间密切配合，敲定最终方案，然后合力做出实物
## 二、产品概述
### 名称
可拓展的循迹小车平台
### 产品目的
搭建一个平台，以后很多模块都可以加在小车这个载体上；
进行一次完整的小组协作；
了解一个项目的全流程；
积累电赛时可用的模块；
注意：这个小车的所有模块：包括电机和轮子、底盘、驱动、主板、传感器、代码，全部都有成熟、开源方案，一个人造出小车都很容易，但是这不是主要目的
## 三、产品功能需求
### 主要功能
- 差速四驱小车的运动控制：加速，减速，转向等常规功能，不做常规后驱汽车的前轮转向（常规后驱前转向的汽车是阿克曼车模型）以及PID算法的优化功能
- 循迹：基于K210人工智能摄像头的循迹，用一个摄像头实现多路灰度传感器的功能，实现任何线迹宽度的可靠循迹，具备岔路口、十字路口的识别功能
- 超声：基于最常见的HCSR04的超声波避障、距离检测功能
### 拓展功能
- PS2手柄：不能遥控的车就是白做了
- 麦轮全向控制：将轮子改为麦轮，再copy代码即可实现全向控制
- 蓝牙通讯：在主控MCU上加入常见的蓝牙模块，实现人机交互、小车与小车之间的交互
- 二维云台：使用两个普通舵机，进行机械设计后，实现二维云台的功能（后期视情况使用总线舵机或无刷电机，因为红绿点跟踪题中，普通舵机表现效果可能会很差）
- 弹射物投掷：
- 人机交互：输入要有按键、足够多的串口、点击使能开关；输出要有OLED、可使能的蜂鸣器、三个LED状态显示灯
- 七路灰度传感：使用七路灰度传感装置，实现传统的循线，防止禁用摄像头的情况
- 二维激光雷达：首先实现激光雷达的避障，后续再谈惯导
- IMU：陀螺仪、加速度计等，后续惯导再谈
### 功能模块
#### 电源
使用3S锂电池（12V供电）（目前的设计不为低能耗、低重量、小体积的小车服务），配有可焊接的DCDC（12V-->5V）模块，配有可焊接的LDO（5V-->3.3V）模块，可焊接模块应当与洞洞板兼容，且可用杜邦线代替连接，同时加上放呆电路，防短路电路（烧主板这件事实在是太常见啦！🤣）
#### 电机驱动
自制一个基于AT8286电机驱动板，因为L298N本来就不是为了小电机而设计的（且社团的下一个任务就是有刷电机驱动，顺便做了😏）
该电机驱动板需要有4路驱动，应有良好的散热设计，占用4个中级定时器，共计16个IO口，且可以使能
#### 主控MCU
基于STM32F407ZGT6，定时器多，IO口多，实验室多（随便薅 bushi）包含四个串口（K210，download，蓝牙，雷达），两个IIC（其中一个连接OLED），两个SPI，六个定时器（连接电机，有两个通道的PWM共8路，四个通道的编码器共8路），普通IO（一个蜂鸣器，七个灰度传感，两个超声，三个按键，三个LED状态灯，四个PS手柄），三个ADC（电压保护），一个DAC。其他规律引出
#### K210
通过一个串口与主控MCU通讯，K210要固定在一个稳固、可手动调节的支架上，K210要支持使用主控板上的按键进行二值化调试
## 四、产品性能需求
1. 能跑，能停
2. 能够实现不同宽度的线的循迹，需要完成2022年（7月）C题的单车走两圈任务
## 产品设计要求
- 电机和电池较重，需要有可靠的底盘设计
- 可拓展模块较多，需要提前调研（虽然多做几版也可以）
- 其他通用的设计要求
### 结构设计
- 建议参考市场化的方案，即双层底盘，电机挂在下层，中层放置驱动和电池，上层放置主控和其他模块
- 尺寸暂时没有要求（因为模块众多，超出电赛的要求尺寸也没有关系的。。。吧）
- 最终定稿后再做其他要求
### 材料选择
- 最终定稿后再做其他要求
## 五、其他
### 测试场地
往年题的循迹场地是有卖的
### 困难的地方

- 写固件是一个麻烦，需要帮助
- 第一次和机械协作，经验不足
### 风险评估

- 有一定的概率1个月做不出来，有一定的概率固件写不出来且自制模块难以找到源码
- 是否需要准备第二个赛道，比如精密仪器测量
- 真正的电赛时间紧迫，四天时间不太可能打板，只能用已有的模块+洞洞板/面包板，需要积攒可用模块

